import { Machine, interpret } from "xstate";
import { useMachine } from "@xstate/react";
import { Inspector } from "../components/Inspector.jsx";
import { useState } from "react";
import { MachineViz } from "../components/xstate-viz/src/MachineViz";
import { CodeSandbox } from "../components/embeds";

export const machine = Machine({
  initial: "a",
  states: { a: { on: { MOVE: "b" } }, b: { on: { MOVE: "a" } } },
});

export const inputMachine = Machine({
  id: "input-mode",
  initial: "normal",
  context: {
    cursorPointer: undefined,
    textLength: undefined,
  },
  states: {
    normal: {
      entry: "applyNormalModeStyles",
      on: {
        INSERT: "insert",
        VISUAL: "visual",
        REPLACE: "replace",
        CURSOR_LEFT: {
          target: ".",
          actions: "moveLeft",
          internal: true,
        },
        CURSOR_RIGHT: {
          target: ".",
          actions: "moveRight",
          internal: true,
        },
      },
    },
    visual: {
      entry: "applyVisualModeStyles",
      on: { NORMAL: "normal" },
    },
    insert: {
      entry: "applyInsertModeStyles",
      on: {
        NORMAL: "normal",
        UPDATE_TEXT: {
          target: ".",
          actions: "updateText",
        },
      },
    },
    replace: {
      entry: "applyReplaceModeStyles",
      on: { NORMAL: "normal" },
    },
  },
});

export const TTT = () => {
  const [current, send, service] = useMachine(inputMachine, { devtools: true });
  console.log(service);
  return (
    <>
      <h1>Here's a button, click it!</h1>
      <p>
        Available Events:{" "}
        {current.nextEvents.map((event) => (
          <button key={event} onClick={() => ({ currentState: send(event) })}>
            {event}
          </button>
        ))}
      </p>
      <p>
        State: <code>{current.value}</code>
      </p>
      <MachineViz machine={inputMachine} state={service.state} />
    </>
  );
};

# TodoMVC Examples

Both demos share the same machines.

## TodoMVC with React

- Uses React with hooks
- Two machines:
  - `todosMachine` controls the overall Todos application
  - `todoMachine` controls each individual todo item.

<!-- <CodeSandbox codeSandboxId="xstate-todomvc-33wr94qv1" /> -->

## TodoMVC with Vue

- Uses Vue with [Composition API](https://vue-composition-api-rfc.netlify.com/)
- Two machines:

  - `todosMachine` controls the overall Todos application
  - `todoMachine` controls each individual todo item.

<!-- <CodeSandbox codeSandboxId="blue-fire-zd796" /> -->

<TTT />
